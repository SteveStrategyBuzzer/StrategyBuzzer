#!/usr/bin/env php
<?php

use Illuminate\Contracts\Console\Kernel;

define('LARAVEL_START', microtime(true));

// Force PostgreSQL connection with environment variables
putenv('DB_CONNECTION=pgsql');
if (getenv('PGHOST')) putenv('DB_HOST=' . getenv('PGHOST'));
if (getenv('PGPORT')) putenv('DB_PORT=' . getenv('PGPORT'));
if (getenv('PGDATABASE')) putenv('DB_DATABASE=' . getenv('PGDATABASE'));
if (getenv('PGUSER')) putenv('DB_USERNAME=' . getenv('PGUSER'));
if (getenv('PGPASSWORD')) putenv('DB_PASSWORD=' . getenv('PGPASSWORD'));

require __DIR__.'/vendor/autoload.php';

$app = require_once __DIR__.'/bootstrap/app.php';

$kernel = $app->make(Kernel::class);

$status = $kernel->handle(
    $input = new Symfony\Component\Console\Input\ArgvInput,
    new Symfony\Component\Console\Output\ConsoleOutput
);

$kernel->terminate($input, $status);

exit($status);
