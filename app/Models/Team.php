<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;

class Team extends Model
{
    public const EMBLEM_CATEGORIES = [
        'animals' => ['ðŸ¦', 'ðŸ¯', 'ðŸ»', 'ðŸ¦Š', 'ðŸº', 'ðŸ¦…', 'ðŸ¦ˆ', 'ðŸ‰', 'ðŸ¦–', 'ðŸ¦‹', 'ðŸ', 'ðŸ¦‚', 'ðŸ¦€', 'ðŸ™', 'ðŸ¦‘', 'ðŸ¬', 'ðŸ³', 'ðŸ¦­', 'ðŸ˜', 'ðŸ¦', 'ðŸ¦›', 'ðŸª', 'ðŸ¦’', 'ðŸ¦˜', 'ðŸ¦¡', 'ðŸ¦”', 'ðŸ¿ï¸', 'ðŸ¦‡', 'ðŸ¦‰', 'ðŸ¸', 'ðŸŠ', 'ðŸ¢', 'ðŸ¦Ž', 'ðŸ', 'ðŸ¦“', 'ðŸ¦¬', 'ðŸ—', 'ðŸ¦Œ', 'ðŸ', 'ðŸ', 'ðŸ“', 'ðŸ¦ƒ', 'ðŸ¦¢', 'ðŸ¦©', 'ðŸ¦š', 'ðŸ¦œ', 'ðŸ¦¤', 'ðŸ•Šï¸', 'ðŸ•', 'ðŸˆ'],
        'warriors' => ['âš”ï¸', 'ðŸ—¡ï¸', 'ðŸ›¡ï¸', 'ðŸ¹', 'ðŸª“', 'ðŸ”±', 'âš’ï¸', 'ðŸªƒ', 'ðŸŽ¯', 'ðŸ’£', 'ðŸ§¨', 'ðŸª–', 'â›‘ï¸', 'ðŸ¥·', 'ðŸ¤º', 'ðŸ¦¸', 'ðŸ¦¹', 'ðŸ‘¹', 'ðŸ‘º', 'ðŸ’€', 'â˜ ï¸', 'ðŸ‘»', 'ðŸ¤–', 'ðŸ‘½', 'ðŸ‘¾', 'ðŸ¦¾', 'ðŸ¦¿', 'ðŸ´â€â˜ ï¸', 'âš“', 'ðŸŽ–ï¸', 'ðŸ…', 'ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', 'ðŸŽ—ï¸', 'ðŸŽª', 'ðŸŽ­', 'ðŸª¬', 'ðŸ”®', 'ðŸ“¿', 'ðŸ’Ž', 'ðŸ‘‘', 'ðŸ’', 'ðŸ§¿', 'âšœï¸', 'ðŸ”°', 'âš¡', 'ðŸŒŸ', 'âœ¨', 'ðŸ’«'],
        'sports' => ['ðŸ†', 'âš½', 'ðŸ€', 'ðŸˆ', 'âš¾', 'ðŸ¥Ž', 'ðŸŽ¾', 'ðŸ', 'ðŸ‰', 'ðŸŽ±', 'ðŸ“', 'ðŸ¸', 'ðŸ’', 'ðŸ‘', 'ðŸ¥', 'ðŸ', 'ðŸ¥Š', 'ðŸ¥‹', 'â›³', 'ðŸŒï¸', 'ðŸŽ¿', 'â›·ï¸', 'ðŸ‚', 'ðŸ›·', 'ðŸ¥Œ', 'ðŸ„', 'ðŸš£', 'ðŸŠ', 'ðŸš´', 'ðŸ‡', 'ðŸ¤¸', 'ðŸ¤¼', 'ðŸ¤½', 'ðŸ¤¾', 'ðŸ§—', 'ðŸŽ³', 'ðŸŽ½', 'ðŸ¥…', 'ðŸŽ£', 'ðŸ¤¿', 'ðŸŽ®', 'ðŸ•¹ï¸', 'ðŸŽ²', 'ðŸŽ¯', 'ðŸŽ°', 'ðŸ§©', 'â™Ÿï¸', 'ðŸŽª', 'ðŸŽ¨', 'ðŸŽ¬'],
        'symbols' => ['ðŸŒŸ', 'â­', 'âœ¨', 'ðŸ’«', 'ðŸ”¥', 'ðŸ’§', 'ðŸŒŠ', 'âš¡', 'â„ï¸', 'ðŸŒˆ', 'â˜€ï¸', 'ðŸŒ™', 'âš›ï¸', 'â™¾ï¸', 'â˜¯ï¸', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ðŸ•‰ï¸', 'âœ¡ï¸', 'ðŸ”¯', 'ðŸª¬', 'â˜¸ï¸', 'âšœï¸', 'â™»ï¸', 'âš ï¸', 'â˜¢ï¸', 'â˜£ï¸', 'ðŸ”±', 'ðŸ“›', 'ðŸ”´', 'ðŸŸ ', 'ðŸŸ¡', 'ðŸŸ¢', 'ðŸ”µ', 'ðŸŸ£', 'ðŸŸ¤', 'âš«', 'âšª', 'ðŸ”¶', 'ðŸ”·', 'ðŸ”º', 'ðŸ”»', 'ðŸ’ ', 'ðŸ”˜', 'ðŸ”²', 'ðŸ”³', 'â–ªï¸', 'â–«ï¸', 'â—¾'],
        'elements' => ['ðŸ”¥', 'ðŸ’§', 'ðŸŒŠ', 'âš¡', 'â„ï¸', 'ðŸŒªï¸', 'â˜ï¸', 'ðŸŒˆ', 'â˜€ï¸', 'ðŸŒ™', 'â­', 'ðŸŒ', 'ðŸŒ', 'ðŸŒŽ', 'ðŸ—ºï¸', 'ðŸ”ï¸', 'â›°ï¸', 'ðŸŒ‹', 'ðŸ—»', 'ðŸ•ï¸', 'ðŸï¸', 'ðŸœï¸', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŒµ', 'ðŸŒ¾', 'ðŸŒ»', 'ðŸŒº', 'ðŸŒ¸', 'ðŸŒ¹', 'ðŸ¥€', 'ðŸ€', 'ðŸ', 'ðŸ‚', 'ðŸƒ', 'ðŸ’', 'ðŸŒ·', 'ðŸª·', 'ðŸª»', 'ðŸŒ¼', 'ðŸª´', 'ðŸŽ‹', 'ðŸŽ', 'ðŸŽ„', 'ðŸªµ', 'ðŸª¨', 'ðŸ’Ž', 'ðŸ”®', 'ðŸ§Š'],
        'gaming' => ['ðŸŽ®', 'ðŸ•¹ï¸', 'ðŸ‘¾', 'ðŸ¤–', 'ðŸŽ²', 'ðŸŽ¯', 'ðŸŽ°', 'ðŸ§©', 'â™Ÿï¸', 'ðŸƒ', 'ðŸ€„', 'ðŸŽ´', 'ðŸŽª', 'ðŸŽ¨', 'ðŸŽ¬', 'ðŸŽ¤', 'ðŸŽ§', 'ðŸŽ¼', 'ðŸŽ¹', 'ðŸ¥', 'ðŸŽ·', 'ðŸŽº', 'ðŸŽ¸', 'ðŸª•', 'ðŸŽ»', 'ðŸª—', 'ðŸŽ­', 'ðŸŽª', 'ðŸŽŸï¸', 'ðŸŽ«', 'ðŸŽžï¸', 'ðŸ“½ï¸', 'ðŸŽ¥', 'ðŸ“º', 'ðŸ“»', 'ðŸ”Š', 'ðŸ“±', 'ðŸ’»', 'ðŸ–¥ï¸', 'âŒ¨ï¸', 'ðŸ–±ï¸', 'ðŸ•¶ï¸', 'ðŸ¥½', 'ðŸŽšï¸', 'ðŸ“¡', 'ðŸ”‹', 'ðŸ’¿', 'ðŸ“€', 'ðŸ’¾', 'ðŸ–²ï¸'],
        'royalty' => ['ðŸ‘‘', 'ðŸ°', 'ðŸ¯', 'âšœï¸', 'ðŸ”±', 'ðŸ’', 'ðŸ“¿', 'ðŸ‘¸', 'ðŸ¤´', 'ðŸ§”', 'ðŸ§™', 'ðŸ§š', 'ðŸ§›', 'ðŸ§œ', 'ðŸ§', 'ðŸ§ž', 'ðŸ§Ÿ', 'ðŸ¦¸', 'ðŸ¦¹', 'ðŸŽ­', 'ðŸ—ï¸', 'ðŸ”', 'ðŸ“œ', 'ðŸ“¯', 'ðŸ””', 'ðŸŽº', 'ðŸŽ–ï¸', 'ðŸ…', 'ðŸ¥‡', 'ðŸª™', 'ðŸ’°', 'ðŸ’Ž', 'ðŸ†', 'ðŸŽ—ï¸', 'ðŸŽ€', 'ðŸŽ', 'ðŸ•¯ï¸', 'ðŸª”', 'ðŸ®', 'ðŸª­', 'ðŸª®', 'ðŸ‘’', 'ðŸŽ©', 'ðŸ§¢', 'ðŸ’„', 'ðŸ’…', 'ðŸ§£', 'ðŸ§¤', 'ðŸ§¦', 'ðŸ‘—'],
        'flags' => ['ðŸ³ï¸', 'ðŸ´', 'ðŸ', 'ðŸš©', 'ðŸŽŒ', 'ðŸ´â€â˜ ï¸', 'ðŸ‡«ðŸ‡·', 'ðŸ‡¬ðŸ‡§', 'ðŸ‡ºðŸ‡¸', 'ðŸ‡©ðŸ‡ª', 'ðŸ‡ªðŸ‡¸', 'ðŸ‡®ðŸ‡¹', 'ðŸ‡µðŸ‡¹', 'ðŸ‡§ðŸ‡·', 'ðŸ‡¯ðŸ‡µ', 'ðŸ‡°ðŸ‡·', 'ðŸ‡¨ðŸ‡³', 'ðŸ‡®ðŸ‡³', 'ðŸ‡·ðŸ‡º', 'ðŸ‡¦ðŸ‡º', 'ðŸ‡¨ðŸ‡¦', 'ðŸ‡²ðŸ‡½', 'ðŸ‡¦ðŸ‡·', 'ðŸ‡¨ðŸ‡±', 'ðŸ‡¨ðŸ‡´', 'ðŸ‡µðŸ‡ª', 'ðŸ‡»ðŸ‡ª', 'ðŸ‡ªðŸ‡¨', 'ðŸ‡§ðŸ‡´', 'ðŸ‡µðŸ‡¾', 'ðŸ‡ºðŸ‡¾', 'ðŸ‡¬ðŸ‡·', 'ðŸ‡¹ðŸ‡·', 'ðŸ‡ªðŸ‡¬', 'ðŸ‡¿ðŸ‡¦', 'ðŸ‡³ðŸ‡¬', 'ðŸ‡°ðŸ‡ª', 'ðŸ‡²ðŸ‡¦', 'ðŸ‡¹ðŸ‡³', 'ðŸ‡¸ðŸ‡³', 'ðŸ‡¨ðŸ‡®', 'ðŸ‡¬ðŸ‡­', 'ðŸ‡¨ðŸ‡²', 'ðŸ‡¸ðŸ‡ª', 'ðŸ‡³ðŸ‡´', 'ðŸ‡©ðŸ‡°', 'ðŸ‡«ðŸ‡®', 'ðŸ‡®ðŸ‡ª', 'ðŸ‡³ðŸ‡±', 'ðŸ‡§ðŸ‡ª'],
        'masks' => ['ðŸŽ­', 'ðŸ‘¹', 'ðŸ‘º', 'ðŸ¤¡', 'ðŸ’€', 'â˜ ï¸', 'ðŸ‘»', 'ðŸ‘½', 'ðŸ‘¾', 'ðŸ¤–', 'ðŸ˜ˆ', 'ðŸ‘¿', 'ðŸŽƒ', 'ðŸŒš', 'ðŸŒ', 'ðŸŒ›', 'ðŸŒœ', 'ðŸŒž', 'ðŸ™ˆ', 'ðŸ™‰', 'ðŸ™Š', 'ðŸµ', 'ðŸ¦', 'ðŸ¯', 'ðŸ»', 'ðŸ¼', 'ðŸ¨', 'ðŸ®', 'ðŸ·', 'ðŸ¸', 'ðŸ²', 'ðŸ‰', 'ðŸ¦Š', 'ðŸº', 'ðŸ¦', 'ðŸ±', 'ðŸ­', 'ðŸ¹', 'ðŸ°', 'ðŸ¦„', 'ðŸ¦‹', 'ðŸ', 'ðŸ¦‚', 'ðŸ•·ï¸', 'ðŸ¦…', 'ðŸ¦‰', 'ðŸ¦‡', 'ðŸ', 'ðŸ¦Ž', 'ðŸ¢'],
        'gems' => ['ðŸ’Ž', 'ðŸ’', 'ðŸ‘‘', 'ðŸ”®', 'ðŸ§¿', 'ðŸ“¿', 'ðŸª¬', 'âœ¨', 'â­', 'ðŸŒŸ', 'ðŸ’«', 'ðŸ”¥', 'â„ï¸', 'ðŸŒˆ', 'ðŸŒŠ', 'âš¡', 'â˜€ï¸', 'ðŸŒ™', 'ðŸ”´', 'ðŸŸ ', 'ðŸŸ¡', 'ðŸŸ¢', 'ðŸ”µ', 'ðŸŸ£', 'ðŸ’œ', 'ðŸ’™', 'ðŸ’š', 'ðŸ’›', 'ðŸ§¡', 'â¤ï¸', 'ðŸ¤', 'ðŸ–¤', 'ðŸ¤Ž', 'ðŸ’”', 'â£ï¸', 'ðŸ’•', 'ðŸ’–', 'ðŸ’—', 'ðŸ’˜', 'ðŸ’', 'ðŸ’ž', 'ðŸ’Ÿ', 'â™¥ï¸', 'ðŸ©·', 'ðŸ©µ', 'ðŸ©¶', 'ðŸª©', 'ðŸŽ±', 'ðŸ”˜', 'âš«'],
    ];

    protected $fillable = [
        'name',
        'tag',
        'captain_id',
        'division',
        'points',
        'level',
        'matches_played',
        'matches_won',
        'matches_lost',
        'is_recruiting',
        'emblem_category',
        'emblem_index',
        'custom_emblem_path',
    ];

    protected $casts = [
        'is_recruiting' => 'boolean',
        'points' => 'integer',
        'level' => 'integer',
        'matches_played' => 'integer',
        'matches_won' => 'integer',
        'matches_lost' => 'integer',
        'emblem_index' => 'integer',
    ];

    public static array $emblemCategories = [
        'animals' => ['name' => 'Animaux', 'icon' => 'ðŸ¦', 'count' => 50],
        'warriors' => ['name' => 'Guerriers', 'icon' => 'âš”ï¸', 'count' => 50],
        'sports' => ['name' => 'Sport', 'icon' => 'ðŸ†', 'count' => 50],
        'symbols' => ['name' => 'Symboles', 'icon' => 'ðŸŒŸ', 'count' => 50],
        'elements' => ['name' => 'Ã‰lÃ©ments', 'icon' => 'ðŸ”¥', 'count' => 50],
        'gaming' => ['name' => 'Gaming', 'icon' => 'ðŸŽ®', 'count' => 50],
        'royalty' => ['name' => 'RoyautÃ©', 'icon' => 'ðŸ‘‘', 'count' => 50],
        'flags' => ['name' => 'Drapeaux', 'icon' => 'ðŸŒ', 'count' => 50],
        'masks' => ['name' => 'Masques', 'icon' => 'ðŸŽ­', 'count' => 50],
        'gems' => ['name' => 'Gemmes', 'icon' => 'ðŸ’Ž', 'count' => 50],
    ];

    public function getEmblemUrl(): string
    {
        if ($this->custom_emblem_path) {
            return asset('storage/' . $this->custom_emblem_path);
        }
        return asset("emblems/{$this->emblem_category}/{$this->emblem_index}.svg");
    }

    public function captain(): BelongsTo
    {
        return $this->belongsTo(User::class, 'captain_id');
    }

    public function members(): BelongsToMany
    {
        return $this->belongsToMany(User::class, 'team_members')
            ->withPivot(['role', 'joined_at'])
            ->withTimestamps();
    }

    public function teamMembers(): HasMany
    {
        return $this->hasMany(TeamMember::class);
    }

    public function matchesAsTeam1(): HasMany
    {
        return $this->hasMany(LeagueTeamMatch::class, 'team1_id');
    }

    public function matchesAsTeam2(): HasMany
    {
        return $this->hasMany(LeagueTeamMatch::class, 'team2_id');
    }

    public function isFull(): bool
    {
        return $this->members()->count() >= 5;
    }

    public function isMember(int $userId): bool
    {
        return $this->members()->where('users.id', $userId)->exists();
    }

    public function isCaptain(int $userId): bool
    {
        return $this->captain_id === $userId;
    }

    public function canAddMember(): bool
    {
        return !$this->isFull();
    }

    public function getWinRate(): float
    {
        if ($this->matches_played === 0) {
            return 0.0;
        }
        return ($this->matches_won / $this->matches_played) * 100;
    }
}
